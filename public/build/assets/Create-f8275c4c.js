import{_ as p}from"./InputForm-616ceab2.js";import{_ as L}from"./SelectForm-40bf11e9.js";import{_ as O}from"./FormModal-2752a17e.js";import{_ as w}from"./AppLayout-6e49c07f.js";import{t as c}from"./toast-860d5cef.js";import B from"./SearchProducts-135f3b19.js";import M from"./SelectedProducts-7bd4d86a.js";import{r as m,k as N,l as T,c as D,o as y,g as F,h as g,b as i,t as v,d as u,a as _,F as C,e as S,i as I}from"./app-36cbb5c9.js";import"./createVueComponent-3fba61fe.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./IconTrash-ef02e0ff.js";const z={class:"title mt-1"},Q={class:"grid grid-cols-2 gap-4"},R={class:"grid grid-cols-2 gap-4"},A={class:"flex justify-end col-span-2"},G={class:"text-xl font-bold"},H=i("option",{selected:"",disabled:"",value:""},"Seleccionar medida",-1),J=["value"],K={class:"flex justify-end col-span-2"},W={class:"text-xl font-bold text-end"},X={class:"mb-2"},se={__name:"Create",props:{products:{type:Object,required:!1},type:{type:String,required:!0}},setup(d){const r=d,b={buy:"Comprar",sell:"Vender"},U=[{name:"Inicio",route:route("dashboard.users.index")},{name:b[r.type],route:route("dashboard.transactions.create",r.type)}],o=m([]),f=m(!1),V=m(!1),n=m([]),s=m(null),q=m(null),P={id:null,name:null,image:null,quantity:1,cost:null,price:null,measure:null,inventory_id:null},e=N({...P});function h(t){e.id=t.id,e.name=t.name,e.image=t.image,e.quantity=1,r.type=="sell"&&(n.value=t.inventory,s.value=n.value[0].id,e.inventory_id=n.value[0].id),f.value=!0}function k(){if(r.type=="sell"&&o.value.find(t=>t.id==e.id&&t.inventory_id==e.inventory_id)){c.error("Este producto con esta medida ya ha sido agregado");return}if(r.type=="buy"&&o.value.find(t=>t.id==e.id&&t.measure==e.measure)){c.error("Este producto con esta medida ya ha sido agregado");return}if(r.type=="sell"&&e.quantity>x.value){c.error("La cantidad no puede ser mayor a la disponible");return}V.value?(o.value[q.value]={...e},c.success("Producto actualizado")):(o.value.push({...e}),c.success("Producto agregado")),$()}function $(){Object.assign(e,P),V.value=!1,n.value=[],s.value=null,q.value=null,f.value=!1}function j(t){e.id=o.value[t].id,e.name=o.value[t].name,e.image=o.value[t].image,e.quantity=o.value[t].quantity,e.price=o.value[t].price,r.type=="sell"?(n.value=r.products.find(a=>a.id==e.id).inventory,e.inventory_id=o.value[t].inventory_id,s.value=o.value[t].inventory_id):(e.cost=o.value[t].cost,e.measure=o.value[t].measure),V.value=!0,q.value=t,f.value=!0}function E(t){o.value.splice(t,1),c.success("Producto eliminado")}T(()=>s.value,t=>{if(!t)return;const a=n.value.find(l=>l.id==t);e.measure=a.measure,e.price=a.unit_price,e.inventory_id=a.id});const x=D(()=>n.value.length==0||!s.value?0:n.value.find(t=>t.id==s.value).quantity);return(t,a)=>(y(),F(w,{title:b[d.type],breads:U},{header:g(()=>[i("span",z,v(b[d.type]),1)]),default:g(()=>[i("div",Q,[u(B,{products:d.products,onSetProduct:h},null,8,["products"]),u(M,{products:o.value,type:d.type,onEdit:j,onRemove:E},null,8,["products","type"])]),u(O,{show:f.value,title:e.name,onOnCancel:a[6]||(a[6]=l=>$()),onOnSubmit:a[7]||(a[7]=l=>k())},{default:g(()=>[i("div",R,[d.type=="buy"?(y(),_(C,{key:0},[u(p,{text:"Medida",modelValue:e.measure,"onUpdate:modelValue":a[0]||(a[0]=l=>e.measure=l),required:""},null,8,["modelValue"]),u(p,{text:"Cantidad",modelValue:e.quantity,"onUpdate:modelValue":a[1]||(a[1]=l=>e.quantity=l),type:"number",required:"",min:1},null,8,["modelValue"]),u(p,{text:"Costo (Unidad)",modelValue:e.cost,"onUpdate:modelValue":a[2]||(a[2]=l=>e.cost=l),type:"number",required:"",min:1},null,8,["modelValue"]),u(p,{text:"Precio (Unidad)",modelValue:e.price,"onUpdate:modelValue":a[3]||(a[3]=l=>e.price=l),type:"number",required:"",min:1},null,8,["modelValue"]),i("div",A,[i("div",G," Total: "+v((e.quantity*e.cost).toLocaleString()),1)])],64)):S("",!0),d.type=="sell"?(y(),_(C,{key:1},[u(L,{text:"Medida",modelValue:s.value,"onUpdate:modelValue":a[4]||(a[4]=l=>s.value=l),required:""},{default:g(()=>[H,(y(!0),_(C,null,I(n.value,l=>(y(),_("option",{value:l.id},v(l.measure)+" - C$"+v(l.unit_price),9,J))),256))]),_:1},8,["modelValue"]),u(p,{text:"Cantidad",modelValue:e.quantity,"onUpdate:modelValue":a[5]||(a[5]=l=>e.quantity=l),type:"number",required:"",min:1,description:`Disponible: ${x.value}`},null,8,["modelValue","description"]),i("div",K,[i("div",W,[i("div",X,"Precio: C$"+v(e.price.toLocaleString()),1),i("div",null,"Total: C$"+v((e.quantity*e.price).toLocaleString()),1)])])],64)):S("",!0)])]),_:1},8,["show","title"])]),_:1},8,["title"]))}};export{se as default};
