import{T as k,c as $,o as a,a as l,e as r,F as b,r as V,b as n,d as f,u as i,t as d,g as w,f as S,x as q}from"./app-eb5825c1.js";import{_ as p}from"./InputForm-94f64246.js";import{t as v}from"./toast-c8752f0b.js";import{c as T}from"./helpers-11977012.js";import{C as j}from"./Carbon-053ffa43.js";import{_ as U}from"./ColorList-b0c3addb.js";import{I as D}from"./IconTrash-2b6e5d65.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./createVueComponent-da84b992.js";const L={key:0,class:"h-full text-center text-gray-400 flex items-center justify-center"},N={class:"w-full rounded-lg p-4 bg-white mb-2 border-2"},P={class:"flex gap-2"},B={key:0,class:"h-36 w-36 flex items-center justify-center"},E=["src"],I={class:"w-full flex flex-col justify-between"},O={class:"mb-3"},R=["onClick"],A={class:"text-gray-400"},F={key:0},z={class:"flex items-center justify-between"},G={key:0,class:"flex flex-col text-end text-xl font-bold"},H={key:1},M={key:0,class:"text-red-300 text-sm"},Y={class:"text-xl font-bold"},J={key:1,class:"mt-4"},K={class:"grid grid-cols-2 gap-4"},Q={key:0,class:"text-gray-400"},W={key:1},X=["onClick"],Z={class:"flex justify-end my-8"},ee={class:"text-xl font-bold"},te=n("button",{class:"secondary-button"},"Cancelar",-1),ue={__name:"SelectedProducts",props:{products:{type:Object,required:!1},type:{type:String,required:!0}},setup(c){const m=c,s=k({type:m.type,discount:0,note:"",client:"",total:0,products:null,payment:null}),y=$(()=>m.type=="buy"?m.products.reduce((t,o)=>t+o.quantity*o.cost,0)-(s.discount??0):m.products.reduce((t,o)=>t+(o.quantity*o.price-o.discount),0)-(s.discount??0));function x(){T({onConfirm:()=>{h()}})}function h(){_(),s.post(route("dashboard.transactions.store"),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{v.success("Transaccion relizada correctamente")}})}function _(){s.products=m.products.map(function(t){return{product_id:t.id,quantity:t.quantity,measure:t.measure,cost:t.cost,price:t.price,inventory_id:t.inventory_id,discount:t.discount??0,name:t.name,expired_at:t.expired_at,colors:t.colorsToRemove.length>0?t.colors.filter(o=>!t.colorsToRemove.includes(o)):t.colors}}),s.total=y.value,s.client=s.client?s.client.toUpperCase():null}function g(t){t.preventDefault(),_(),q.post(route("dashboard.download.proforma"),s,{responseType:"blob"}).then(o=>{const e=window.URL.createObjectURL(new Blob([o.data])),u=document.createElement("a");u.href=e,u.setAttribute("download",`Proforma_${j.create().format("m_d_Y_H_i")}.xlsx`),document.body.appendChild(u),u.click()}).catch(()=>{v.error("Ocurrio un error al descargar la proforma")})}return(t,o)=>(a(),l("div",null,[c.products.length==0?(a(),l("div",L," No hay productos seleccionados ")):r("",!0),(a(!0),l(b,null,V(c.products,(e,u)=>(a(),l("div",N,[n("div",P,[e.image?(a(),l("div",B,[n("img",{src:e.image,onerror:"this.src='/not-found.jpg'",alt:"Imagen",class:"max-h-full max-w-full rounded-lg"},null,8,E)])):r("",!0),n("div",I,[n("div",O,[n("div",{class:"text-lg font-semibold mb-2 uppercase",onClick:C=>t.$emit("edit",u),role:"button"},d(e.name)+" - "+d(e.measure)+" ("+d(e.quantity)+") ",9,R),n("div",A,[c.type=="buy"?(a(),l("span",F," Costo: C$"+d(e.cost)+", ",1)):r("",!0),n("span",null," Precio: C$"+d(e.price),1)])]),c.type=="buy"?(a(),w(U,{key:0,colors:e.colors,class:"mb-2"},null,8,["colors"])):r("",!0),n("div",z,[n("div",null,[f(i(D),{role:"button",onClick:C=>t.$emit("remove",u),class:"text-red-300"},null,8,["onClick"])]),c.type=="buy"?(a(),l("div",G," C$"+d((e.quantity*e.cost).toLocaleString("en-US")),1)):r("",!0),c.type=="sell"?(a(),l("div",H,[e.discount>0?(a(),l("span",M," -C$"+d(e.discount),1)):r("",!0),n("span",Y," C$"+d((e.quantity*e.price).toLocaleString("en-US")),1)])):r("",!0)])])])]))),256)),y.value>0?(a(),l("div",J,[n("div",K,[f(p,{text:"Notas (Opcional)",modelValue:i(s).note,"onUpdate:modelValue":o[0]||(o[0]=e=>i(s).note=e)},null,8,["modelValue"]),c.type=="sell"?(a(),l(b,{key:0},[f(p,{text:"Cliente (Opcional)",modelValue:i(s).client,"onUpdate:modelValue":o[1]||(o[1]=e=>i(s).client=e)},null,8,["modelValue"]),f(p,{text:"Descuento C$",modelValue:i(s).discount,"onUpdate:modelValue":o[2]||(o[2]=e=>i(s).discount=e)},null,8,["modelValue"]),f(p,{text:"Pago C$",placeholder:`Todo: C$${y.value}`,modelValue:i(s).payment,"onUpdate:modelValue":o[3]||(o[3]=e=>i(s).payment=e)},null,8,["placeholder","modelValue"])],64)):r("",!0)]),i(s).payment?(a(),l("div",Q," Dejar el campo vacio si desea pagar todo el monto. De lo contrario especifique la cantidad que desea abonar. La transaccion se guardara como PENDIENTE. ")):r("",!0),c.type=="sell"?(a(),l("div",W,[n("button",{type:"button",onClick:S(g,["prevent"])},"Descargar Proforma",8,X)])):r("",!0),n("div",Z,[n("div",ee," Total: C$"+d(y.value.toLocaleString("en-US")),1)]),n("div",{class:"flex items-center justify-end gap-4"},[te,n("button",{class:"primary-button",type:"button",onClick:x}," Guardar ")])])):r("",!0)]))}};export{ue as default};
