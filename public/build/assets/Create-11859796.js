import{i as v,j as N,k as A,c as F,o as n,g as w,h as k,b as u,t as x,d as r,a as i,e as y,F as g,r as P,w as Q,m as W,n as G,q as H}from"./app-7e01fa35.js";import{_}from"./InputForm-e80a44c7.js";import{_ as J}from"./SelectForm-4c87cb50.js";import{_ as K}from"./FormModal-739694c4.js";import{_ as X}from"./AppLayout-b225eee9.js";import{t as b}from"./toast-0681aef9.js";import Y from"./SearchProducts-2336be52.js";import Z from"./SelectedProducts-d0400c78.js";import{_ as ee}from"./ColorList-125ecdf6.js";import"./createVueComponent-d4cf1915.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./lodash-a141f88d.js";import"./helpers-f4191763.js";import"./Carbon-053ffa43.js";import"./IconTrash-ddfd38c1.js";const te={class:"title mt-1"},le={class:"grid grid-cols-2 gap-4"},ae={key:0,class:"h-36 w-36 mb-4"},oe=["src"],ue={class:"grid grid-cols-2 gap-4"},ne={id:"measures"},se=["value"],ie={class:"flex items-center mb-4 col-span-2"},re={class:"flex justify-end col-span-2"},de={class:"text-xl font-bold"},ce=u("option",{selected:"",disabled:"",value:""},"Seleccionar medida",-1),me=["value"],ve=u("div",{class:"block col-span-2"}," Colores a eliminar ",-1),pe={class:"col-span-2 flex items-center gap-2",style:{"flex-wrap":"wrap"}},fe=["onClick"],ye={class:"flex justify-end col-span-2"},ge={class:"text-xl font-bold text-end"},Oe={__name:"Create",props:{products:{type:Object,required:!1},type:{type:String,required:!0},measures:{type:Object,required:!1},is_caducable:{type:Boolean,default:!1}},setup(d){const p=d,$={buy:"Comprar",sell:"Vender"},T=[{name:"Inicio",route:route("dashboard.index")},{name:$[p.type],route:route("dashboard.transactions.create",p.type)}],o=v([]),h=v(!1),V=v(!1),c=v([]),f=v(null),C=v(null),s=v([]),m=v([]),q=v("#000000"),U={id:null,name:null,image:null,quantity:1,cost:null,price:null,measure:null,inventory_id:null,discount:0,expired_at:null,colors:[],colorsToRemove:[]},e=N({...U});function M(t){e.id=t.id,e.name=t.name,e.image=t.image,e.quantity=1,p.type=="sell"?(c.value=t.inventory,f.value=c.value[0].id,e.inventory_id=c.value[0].id,e.discount=t.discount):e.expired_at=t.expired_at,h.value=!0}function O(){if(p.type=="sell"&&R()&&!V.value){b.error("Este producto con esta medida ya ha sido agregado");return}if(p.type=="buy"&&o.value.find(t=>t.id==e.id&&t.measure==e.measure)&&!V.value){b.error("Este producto con esta medida ya ha sido agregado");return}if(p.type=="sell"&&e.quantity>j.value){b.error("La cantidad no puede ser mayor a la disponible");return}e.discount==null&&(e.discount=0),e.colors=s.value,e.colorsToRemove=m.value,V.value?(o.value[C.value]={...e},b.success("Producto actualizado")):(o.value.push({...e}),b.success("Producto agregado")),S()}function R(){return o.value.find(t=>t.id==e.id&&t.inventory_id==e.inventory_id)}function S(){Object.assign(e,U),V.value=!1,c.value=[],f.value=null,C.value=null,h.value=!1,s.value=[],m.value=[]}function B(t){e.id=o.value[t].id,e.name=o.value[t].name,e.image=o.value[t].image,e.quantity=o.value[t].quantity,e.price=o.value[t].price,p.type=="sell"?(c.value=p.products.find(l=>l.id==e.id).inventory,e.inventory_id=o.value[t].inventory_id,f.value=o.value[t].inventory_id,e.discount=o.value[t].discount):(e.cost=o.value[t].cost,e.measure=o.value[t].measure,e.expired_at=o.value[t].expired_at,s.value=o.value[t].colors),V.value=!0,C.value=t,h.value=!0}function E(t){o.value.splice(t,1),b.success("Producto eliminado")}A(()=>f.value,t=>{if(!t)return;const l=c.value.find(a=>a.id==t);e.measure=l.measure,e.price=l.unit_price,e.inventory_id=l.id,s.value=l.colors,C.value!=null?m.value=o.value[C.value].colorsToRemove:m.value=[]});const j=F(()=>c.value.length==0||!f.value?0:c.value.find(t=>t.id==f.value).quantity);function D(){q.value&&(s.value.find(t=>t==q.value)||s.value.push(q.value))}function I(t){s.value=s.value.filter(l=>l!=t)}function L(t){m.value.find(l=>l==t)?m.value=m.value.filter(l=>l!=t):m.value.push(t)}function z(t){return m.value.find(l=>l==t)?"ring-2 ring-indigo-500 ring-offset-1":""}return(t,l)=>(n(),w(X,{title:$[d.type],breads:T},{header:k(()=>[u("span",te,x($[d.type]),1)]),default:k(()=>[u("div",le,[r(Y,{products:d.products,onSetProduct:M},null,8,["products"]),r(Z,{products:o.value,type:d.type,onEdit:B,onRemove:E},null,8,["products","type"])]),r(K,{show:h.value,title:e.name,onOnCancel:l[9]||(l[9]=a=>S()),onOnSubmit:l[10]||(l[10]=a=>O())},{default:k(()=>[e.image?(n(),i("div",ae,[u("img",{src:e.image,onerror:"this.src='/not-found.jpg'",alt:"Imagen",class:"max-h-full max-w-full rounded-lg"},null,8,oe)])):y("",!0),u("div",ue,[d.type=="buy"?(n(),i(g,{key:0},[u("datalist",ne,[(n(!0),i(g,null,P(d.measures,a=>(n(),i("option",{value:a},null,8,se))),256))]),r(_,{text:"Medida",modelValue:e.measure,"onUpdate:modelValue":l[0]||(l[0]=a=>e.measure=a),required:"",min:1,list:"measures"},null,8,["modelValue"]),r(_,{text:"Cantidad",modelValue:e.quantity,"onUpdate:modelValue":l[1]||(l[1]=a=>e.quantity=a),type:"number",required:"",min:1},null,8,["modelValue"]),r(_,{text:"Costo (Unidad)",modelValue:e.cost,"onUpdate:modelValue":l[2]||(l[2]=a=>e.cost=a),type:"number",required:"",min:1},null,8,["modelValue"]),r(_,{text:"Precio (Unidad)",modelValue:e.price,"onUpdate:modelValue":l[3]||(l[3]=a=>e.price=a),type:"number",required:"",min:1},null,8,["modelValue"]),d.is_caducable?(n(),w(_,{key:0,text:"Vence",modelValue:e.expired_at,"onUpdate:modelValue":l[4]||(l[4]=a=>e.expired_at=a),type:"date"},null,8,["modelValue"])):y("",!0),t.$page.props.manage_colors?(n(),i(g,{key:1},[u("div",ie,[u("button",{type:"button",class:"primary-button mr-4",onClick:D}," Agregar color "),Q(u("input",{type:"color","onUpdate:modelValue":l[5]||(l[5]=a=>q.value=a),class:"h-full"},null,512),[[W,q.value]])]),s.value.length>0?(n(),w(ee,{key:0,colors:s.value,onRemoveColor:I},null,8,["colors"])):y("",!0)],64)):y("",!0),u("div",re,[u("div",de," Total: C$"+x((e.quantity*e.cost).toLocaleString()),1)])],64)):y("",!0),d.type=="sell"?(n(),i(g,{key:1},[r(J,{text:"Medida",modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=a=>f.value=a),required:""},{default:k(()=>[ce,(n(!0),i(g,null,P(c.value,a=>(n(),i("option",{value:a.id},x(a.measure)+" - C$"+x(a.unit_price),9,me))),256))]),_:1},8,["modelValue"]),r(_,{text:"Cantidad",modelValue:e.quantity,"onUpdate:modelValue":l[7]||(l[7]=a=>e.quantity=a),type:"number",required:"",min:1,description:`Disponible: ${j.value}`},null,8,["modelValue","description"]),r(_,{text:"Descuento",modelValue:e.discount,"onUpdate:modelValue":l[8]||(l[8]=a=>e.discount=a),type:"number"},null,8,["modelValue"]),s.value?(n(),i(g,{key:0},[ve,u("div",pe,[(n(!0),i(g,null,P(s.value,a=>(n(),i("div",{key:a},[u("div",{class:G(["w-6 h-6 rounded-md",z(a)]),role:"button",style:H({backgroundColor:a}),onClick:_e=>L(a)},null,14,fe)]))),128))])],64)):y("",!0),u("div",ye,[u("div",ge,[u("div",null," Total: C$"+x((e.quantity*e.price-e.discount).toLocaleString()),1)])])],64)):y("",!0)])]),_:1},8,["show","title"])]),_:1},8,["title"]))}};export{Oe as default};
